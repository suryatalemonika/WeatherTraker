<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Weather Tracker</title>
    <link rel="stylesheet" href="style.css">
    <style>
        .hourly-data {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-bottom: 20px;
        }

        .hourly-item {
            text-align: center;
            margin: 10px;
            padding: 10px;
            border: 1px solid #ddd; /* Optional styling */
            border-radius: 5px;     /* Optional styling */
        }

        .hourly-icon {
            width: 50px;  /* Adjust the size of the weather icon */
            height: 50px;
        }
    </style>
</head>

<body>
    <div class="container">
        <!-- Input field and buttons for entering location -->
        <div class="location-input">
            <input type="text" id="location-input" placeholder="Enter location" class="input-field">
            <button id="get-weather-btn" class="get-weather-btn">Get Weather</button>
            <button id="get-history-btn" class="get-history-btn" style="display: none;">Get History</button> <!-- Hidden by default -->
        </div>
        <br>

        <!-- Weather widget (hidden by default) -->
        <div class="weather-widget" id="weather-widget" style="display: none;">
            <div class="weather-info">
                <h3 style="text-align: center;" class="heading">Today</h3>
                <br>
                <div class="temperature-container">
                    <img id="weather-icon" src="" alt="Weather Icon" class="weather-icon">
                    <h1 class="temperature" id="temp">--°C</h1>
                </div>
                <br>
                <p class="description" id="description">--</p>
                <br>
                <p class="location" id="location">--</p>
                <br>
                <p class="date" id="date">21 Oct 2024</p>
                <br>
                <p class="feels-like" id="feels_like">Feels like -- | Sunset: --</p>
                <br>
            </div>
        </div>

        <!-- History widget (hidden by default) -->
        <div class="history-widget" id="history-widget" style="display: none;">
            <h3 style="text-align: center;" class="heading">Hourly Historical Weather Data</h3>
            <div id="history-data"></div> <!-- Container for hourly data -->
        </div>
    </div>

    <script>
        document.getElementById('get-weather-btn').addEventListener('click', function () {
            const location = document.getElementById('location-input').value;
            if (location) {
                fetchWeatherData(location);
            } else {
                alert('Please enter a location!');
            }
        });

        document.getElementById('get-history-btn').addEventListener('click', function () {
            const location = document.getElementById('location-input').value;
            if (location) {
                fetchWeatherHistory(location);
            } else {
                alert('Please enter a location!');
            }
        });

        function fetchWeatherData(location) {
            fetch(`/weather?location=${location}`)
                .then(response => response.json())
                .then(data => {
                    document.getElementById('temp').textContent = `${data.Current_temp}°C`;
                    document.getElementById('description').textContent = data.Weather_description;
                    document.getElementById('weather-icon').src = `http://openweathermap.org/img/wn/${data.Whether_icon}.png`;
                    document.getElementById('feels_like').textContent = `Feels like ${data.feels_like} | Sunset ${data.sunset}`;
                    document.getElementById('location').textContent = data.location;

                    document.getElementById('weather-widget').style.display = 'block';
                    document.getElementById('history-widget').style.display = 'none'; // Hide history widget
                    document.getElementById('get-history-btn').style.display = 'block'; // Show history button
                })
                .catch(error => {
                    console.error('Error fetching the weather data:', error);
                });
        }

        function fetchWeatherHistory(location) {
            const fromDate = new Date().toISOString().split('T')[0]+'T'+'00:00:00Z'; 
            const toDate = new Date().toISOString().split('T')[0]+'T'+'23:59:59.999Z';   

            fetch(`/historydata?location=${location}&from=${fromDate}&to=${toDate}`)
                .then(response => response.json())
                .then(data => {
                    const historyDataDiv = document.getElementById('history-data');
                    historyDataDiv.innerHTML = ''; 
                    
                    data.forEach(entry => {
                        console.log(entry)
                        const entryDiv = document.createElement('div');
                        entryDiv.className = 'hourly-item'; 
                        entryDiv.innerHTML = `
                            <div class="hourly-data">
                                <img src="http://openweathermap.org/img/wn/${entry.Whether_icon}.png" alt="Weather Icon" class="hourly-icon">
                                <p>${entry.time}</p>
                                <p>${entry.Current_temp}°C</p>
                            </div>
                        `;
                        historyDataDiv.appendChild(entryDiv);
                    });

                    document.getElementById('history-widget').style.display = 'block'; // Show history widget
                })
                .catch(error => {
                    console.error('Error fetching the historical weather data:', error);
                });
        }
    </script>
</body>

</html>
